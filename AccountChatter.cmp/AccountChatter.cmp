<aura:component controller="AccountChatterController"
    implements="flexipage:availableForRecordHome,force:hasRecordId,force:lightningQuickAction"
    access="global">

    <aura:attribute name="feedItems" type="List" />
    <aura:attribute name="recordId" type="Id" />
    <aura:attribute name="newPostBody" type="String" />
	<aura:attribute name="isLoading" type="Boolean" default="false"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <lightning:notificationsLibrary aura:id="notifLib" />

    <lightning:card title="Chatter Feed">
		
		<lightning:spinner variant="brand" size="medium" aura:id="spinner" class="{!v.isLoading ? '' : 'slds-hide'}"/>

        <!-- New Feed Post Section -->
        <div class="slds-box slds-m-bottom_medium">
            <lightning:textarea label="Create a Post" value="{!v.newPostBody}" />
            <lightning:button label="Post to Feed" variant="brand" class="slds-m-top_small" onclick="{!c.postFeedItem}" />
        </div>

        <!-- Feed Items and Comments -->
        <aura:iteration items="{!v.feedItems}" var="item">
            <div class="slds-box slds-m-bottom_medium">
                <lightning:layout verticalAlign="start">
                    <lightning:layoutItem flexibility="auto" padding="around-small">
                        <div class="slds-text-heading_small">
                            <lightning:avatar fallbackIconName="standard:user" size="medium" />&nbsp;
                            {!item.createdByName}
                        </div>
                        <div class="slds-m-top_x-small">
                            <lightning:formattedText value="{!item.body}" />
                        </div>
                        <div class="slds-text-color_weak slds-text-body_small slds-m-top_x-small">
                            <lightning:formattedDateTime value="{!item.createdDate}" year="numeric" month="short" day="2-digit" hour="2-digit" minute="2-digit" />
                        </div>

                        <!-- Comments -->
                        <div class="slds-m-top_medium slds-m-left_medium">
                            <aura:iteration items="{!item.comments}" var="comment">
                                <div class="slds-box slds-theme_shade slds-m-bottom_small">
                                    <div class="slds-text-heading_x-small">{!comment.createdByName}</div>
                                    <div class="slds-m-top_xx-small">
                                        <lightning:formattedText value="{!comment.commentBody}" />
                                    </div>
                                    <div class="slds-text-color_weak slds-text-body_small">
                                        <lightning:formattedDateTime value="{!comment.createdDate}" year="numeric" month="short" day="2-digit" hour="2-digit" minute="2-digit" />
                                    </div>
                                </div>
                            </aura:iteration>
                        </div>

                        <!-- Add Comment -->
                        <lightning:textarea label="Add Comment" value="{!item.newComment}" class="slds-m-top_small" />
                        <lightning:button label="Post Comment" variant="brand" onclick="{!c.postComment}" value="{!item.id}" class="slds-m-top_small" />
                    </lightning:layoutItem>
                </lightning:layout>
            </div>
        </aura:iteration>
    </lightning:card>
</aura:component>